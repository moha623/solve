<div class="main-content flex-1 overflow-x-hidden mt-[50px]">
  <!-- Dashboard Content -->
  <div class="p-5">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 mb-8">
      <div class="dashboard-card bg-white p-5 rounded-xl shadow-sm border-r-4 border-primary">
        <div class="flex justify-between items-center">
          <div>
            <p class="text-gray-500">إجمالي المنتجات</p>
            <h3 class="text-2xl font-bold">$</h3>
          </div>
          <div class="bg-blue-100 p-3 rounded-full">
            <i class="fas fa-box text-primary text-xl"></i>
          </div>
        </div>
        <p class="text-sm text-green-500 mt-2">
          <i class="fas fa-arrow-up"></i> 12% منذ الشهر الماضي
        </p>
      </div>

      <div class="dashboard-card bg-white p-5 rounded-xl shadow-sm border-r-4 border-info">
        <div class="flex justify-between items-center">
          <div>
            <p class="text-gray-500">إجمالي الطلبات</p>
            <h3 class="text-2xl font-bold"></h3>
          </div>
          <div class="bg-blue-100 p-3 rounded-full">
            <i class="fas fa-shopping-cart text-info text-xl"></i>
          </div>
        </div>
        <p class="text-sm text-green-500 mt-2">
          <i class="fas fa-arrow-up"></i> 8% منذ الشهر الماضي
        </p>
      </div>

      <div class="dashboard-card bg-white p-5 rounded-xl shadow-sm border-r-4 border-warning">
        <div class="flex justify-between items-center">
          <div>
            <p class="text-gray-500">المرتجعات</p>
            <h3 class="text-2xl font-bold">42</h3>
          </div>
          <div class="bg-yellow-100 p-3 rounded-full">
            <i class="fas fa-undo text-warning text-xl"></i>
          </div>
        </div>
        <p class="text-sm text-red-500 mt-2">
          <i class="fas fa-arrow-down"></i> 3% منذ الشهر الماضي
        </p>
      </div>

      <div class="dashboard-card bg-white p-5 rounded-xl shadow-sm border-r-4 border-success">
        <div class="flex justify-between items-center">
          <div>
            <p class="text-gray-500">الإيرادات</p>
            <h3 class="text-2xl font-bold"></h3>
          </div>
          <div class="bg-green-100 p-3 rounded-full">
            <i class="fas fa-dollar-sign text-success text-xl"></i>
          </div>
        </div>
        <p class="text-sm text-green-500 mt-2">
          <i class="fas fa-arrow-up"></i>+ %منذ الشهر الماضي
        </p>
      </div>
    </div>

    <!-- Add Product Form -->
    <div class="bg-white p-6 rounded-xl shadow-sm mb-8">
      <h2 class="text-xl font-semibold mb-6 text-dark flex items-center">
        <i class="fas fa-plus-circle ml-2 text-primary"></i> إضافة منتج جديد
      </h2>
      <div class="container mx-auto p-6">
        <h1 class="text-2xl font-bold mb-6">لوحة تحكم إضافة المنتجات</h1>

        <form
          *ngIf="productForm"
          [formGroup]="productForm"
          (ngSubmit)="onSubmit()"
          class="grid grid-cols-1 md:grid-cols-2 gap-6"
        >
          <!-- Product Name -->
          <div>
            <label class="block text-gray-700 mb-2">اسم المنتج</label>
            <input
              type="text"
              formControlName="name"
              required
              class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
            />
            @if (productForm.get('name')?.invalid && productForm.get('name')?.touched) {
            <div class="text-red-600 mt-1 text-sm">اسم المنتج مطلوب</div>
            }
          </div>

          <!-- Description -->
          <div>
            <label class="block text-gray-700 mb-2">الوصف</label>
            <textarea
              rows="3"
              formControlName="description"
              required
              class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
            ></textarea>
            @if (productForm.get('description')?.invalid && productForm.get('description')?.touched)
            {
            <div class="text-red-600 mt-1 text-sm">الوصف مطلوب</div>
            }
          </div>

          <!-- Price -->
          <div>
            <label class="block text-gray-700 mb-2">السعر</label>
            <input
              type="number"
              formControlName="price"
              min="0"
              required
              class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
            />
            @if (productForm.get('price')?.invalid && productForm.get('price')?.touched) {
            <div class="text-red-600 mt-1 text-sm">السعر مطلوب ويجب أن يكون صفر أو أكثر</div>
            }
          </div>

          <!-- Original Price -->
          <div>
            <label class="block text-gray-700 mb-2">السعر الأصلي (اختياري)</label>
            <input
              type="number"
              formControlName="originalPrice"
              min="0"
              class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
            />
          </div>

          <!-- Discount -->
          <div>
            <label class="block text-gray-700 mb-2">الخصم (%)</label>
            <input
              type="number"
              formControlName="discount"
              min="0"
              max="100"
              class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
            />
            @if (productForm.get('discount')?.invalid && productForm.get('discount')?.touched) {
            <div class="text-red-600 mt-1 text-sm">يجب أن تكون نسبة الخصم بين 0 و 100</div>
            }
          </div>

          <!-- Rating -->
          <div>
            <label class="block text-gray-700 mb-2">التقييم (0-5)</label>
            <input
              type="number"
              formControlName="rating"
              min="0"
              max="5"
              step="0.1"
              class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
            />
            @if (productForm.get('rating')?.invalid && productForm.get('rating')?.touched) {
            <div class="text-red-600 mt-1 text-sm">يجب أن يكون التقييم بين 0 و 5</div>
            }
          </div>

          <!-- Review Count -->
          <div>
            <label class="block text-gray-700 mb-2">عدد التقييمات</label>
            <input
              type="number"
              formControlName="reviewCount"
              min="0"
              class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
            />
            @if (productForm.get('reviewCount')?.invalid && productForm.get('reviewCount')?.touched)
            {
            <div class="text-red-600 mt-1 text-sm">يجب أن يكون عدد التقييمات صفر أو أكثر</div>
            }
          </div>

          <!-- Delivery Fee -->
          <div>
            <label class="block text-gray-700 mb-2">رسوم التوصيل</label>
            <input
              type="number"
              formControlName="deliveryFee"
              min="0"
              class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
            />
          </div>

          <!-- Features -->
          <div class="md:col-span-2">
            <label class="block text-gray-700 mb-2">الميزات (مفصولة بفواصل)</label>
            <input
              type="text"
              formControlName="features"
              placeholder="ميزة 1, ميزة 2, ميزة 3"
              class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"
            />
          </div>

          <!-- Media Upload -->
          <div class="md:col-span-2">
            <label class="block text-gray-700 mb-2"
              >صور/فيديوهات المنتج (يمكن رفع أكثر من ملف)</label
            >
            <input
              type="file"
              (change)="onMediaSelected($event)"
              accept="image/*,video/*"
              multiple
              #fileInput
              class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-secondary"
            />

            @if (productForm.get('media_urls')?.invalid && productForm.get('media_urls')?.touched) {
            <div class="text-red-600 mt-1 text-sm">مطلوب رفع وسائط للمنتج</div>
            } @if (uploadPercent !== null) {
            <div class="mt-2 text-sm text-gray-600">
              تحميل الوسائط: {{ uploadPercent | number : '1.0-0' }}%
            </div>
            }

            <!-- Media Previews -->
            @if (mediaPreviews.length > 0) {
            <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4">
              @for (media of mediaPreviews; track media.url; let i = $index) {
              <div class="relative border rounded-lg overflow-hidden">
                @if (media.type === 'image') {
                <img
                  [src]="media.url"
                  [alt]="media.name"
                  class="w-full h-32 object-cover"
                  (error)="handleImageError($event)"
                />
                } @else {
                <video class="w-full h-32 object-cover">
                  <source [src]="media.url" type="video/mp4" />
                  متصفحك لا يدعم تشغيل الفيديو
                </video>
                }
                <button
                  type="button"
                  (click)="removeMedia(i)"
                  class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center"
                >
                  &times;
                </button>
                <div class="p-2 text-xs truncate">{{ media.name }}</div>
              </div>
              }
            </div>
            }
          </div>

          <!-- Buttons -->
          <div class="md:col-span-2 flex justify-start space-x-4 space-x-reverse mt-4">
            <button
              type="button"
              (click)="resetForm()"
              class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"
            >
              إعادة تعيين
            </button>
            <button
              type="submit"
              [disabled]="productForm.invalid || loading"
              class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-secondary disabled:opacity-50"
            >
              @if (!loading) {
              <span>إضافة المنتج</span>
              } @if (loading) {
              <span><i class="fas fa-spinner fa-spin"></i> جاري الإضافة...</span>
              }
            </button>
          </div>

          <!-- Success/Error Messages -->
          <div class="md:col-span-2 mt-4">
            @if (successMessage) {
            <div class="mt-6 p-4 bg-green-100 text-green-700 rounded-lg">
              <i class="fas fa-check-circle"></i>
              <p class="text-green-600 font-semibold">{{ successMessage }}</p>
            </div>
            } @if (errorMessage) {
            <div class="mt-6 p-4 bg-red-100 text-red-700 rounded-lg">
              <i class="fas fa-exclamation-circle"></i>
              <p class="text-red-600 font-semibold">{{ errorMessage }}</p>
            </div>
            }
          </div>
        </form>
      </div>
    </div>

    <!-- Products Table -->
    <div class="p-6 rounded-xl shadow-sm mb-8 w-full">
      <h2 class="text-xl font-semibold mb-6 text-dark flex items-center">
        <i class="fas fa-box ml-2 text-primary"></i> جميع المنتجات
      </h2>

      <div class="overflow-x-auto w-full">
        <table class="w-full min-w-[700px] border-collapse">
          <thead>
            <tr class="border-b bg-gray-100">
              <th class="p-4 text-left">المنتج</th>
              <th class="p-4 text-left">الفئة</th>
              <th class="p-4 text-left">السعر</th>
              <th class="p-4 text-left">المخزون</th>
              <th class="p-4 text-left">الحالة</th>
              <th class="p-4 text-center">إجراءات</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of products" class="border-t hover:bg-gray-50">
              <td class="p-4 flex items-center">
                <div
                  class="w-10 h-10 bg-gray-200 rounded-lg ml-3"
                  *ngIf="!product.media_urls?.length"
                ></div>
                <img
                  *ngIf="product.media_urls?.length"
                  [src]="product.media_urls[0]"
                  alt="{{ product.name }}"
                  class="w-10 h-10 object-cover rounded-lg ml-3"
                  (error)="handleImageError($event)"
                />
                <div>
                  <p class="font-semibold">{{ product.name }}</p>
                  <p class="text-gray-500 text-sm">#{{ product.id }}</p>
                </div>
              </td>
              <td class="p-4">{{ product.category || 'غير محدد' }}</td>
              <td class="p-4">${{ product.price }}</td>
              <td class="p-4">{{ product.stock || 0 }}</td>
              <td class="p-4">
                <span [class]="getStatusClass(product)" class="px-2 py-1 text-xs rounded-full">
                  {{ getStatusText(product) }}
                </span>
              </td>
              <td class="p-4">
                <div class="flex justify-center space-x-3 space-x-reverse">
                  <button class="text-blue-500 hover:text-blue-700">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button
                    (click)="openDeleteModal(product)"
                    class="text-red-500 hover:text-red-700"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="w-full m-auto text-center mt-6">
        <p class="text-gray-500">
          عرض {{ startItem() }} - {{ endItem() }} من أصل {{ totalProducts }} منتج
        </p>
        <div class="pt-5 space-x-2 space-x-reverse items-center text-center w-full m-auto">
          <button
            (click)="prevPage()"
            [disabled]="currentPage === 1"
            class="px-3 py-1 border rounded-lg bg-gray-100 text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <i class="fas fa-chevron-right"></i>
          </button>

          <button
            *ngFor="let page of totalPagesArray()"
            (click)="gotoPage(page)"
            [class.bg-primary]="page === currentPage"
            [class.text-white]="page === currentPage"
            class="px-3 py-1 border rounded-lg cursor-pointer"
          >
            {{ page }}
          </button>

          <button
            (click)="nextPage()"
            [disabled]="currentPage === totalPages"
            class="px-3 py-1 border rounded-lg bg-gray-100 text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <i class="fas fa-chevron-left"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
